<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<title>Pictionary: Play with a robot against your friends!</title>
	<link href="bootstrap/css/bootstrap.min.css" rel="stylesheet">
	<link href="css/style.css" rel="stylesheet">
</head>
<body style="font-family: Helvetica;">
	<section id="init">
		<div class="container">
			<h2>Azure Setup</h2>
			<div>
				<h1 style="font-weight:500;">Microsoft Cognitive Services Speech SDK JavaScript Quickstart</h1>
				<form class="form-group">
					<input id="subscriptionKey" type="text" value="ae41fa8eeb1a413baaeac3b80ed9bf18" placeholder="Speech Recognition Key" class="form-control">
					<input id="subscriptionKey" type="text" value="47a317206894400489d697698fdde1c4" placeholder="Speaker Recognition Key" class="form-control">
					<input id="regionKey" type="text" value="westus" placeholder="Region" class="form-control">
					<a href="#" class="btn btn-primary form-control">Setup</a>
				</form>
			</div>
		</div>
	</section>

	<section id="home">
		<div class="container">
			<h2>Welcome to Unnamed Pictionary Game!</h2>
			<h2>Would you like to play by yourself?</h2>
			<a href="#canvas" id="kms"class="btn btn-primary">Yes</a>
			<a href="#enroll" class="btn btn-success">No</a>
		</div>
	</section>

	<section id="enroll">
		<div class="container">
			<h2>Add a person</h2>
			<a id="enrollPlayer" class="btn btn-info">Add another player (up to 10)</a>
		</div>
	</section>

	<section id="play">
		<!-- aaron -->
		<div class="container">
			<div id="canvas" >
				<svg id="working-canvas" width="100%" viewBox="20 5 50 50"><path d="M33.909371979534626,30.66960085183382 m0.5399619787931442,-1.0799239575862885 l1.3499048352241516,-1.0799239575862885 1.8898668885231018,-0.8099429309368134 l1.0799239575862885,1.3499048352241516 2.42982879281044,1.3499048352241516 l1.6198858618736267,0.0 2.159847915172577,-1.0799239575862885 l3.5097527503967285,-0.8099429309368134 2.159847915172577,0.0 l1.3499048352241516,1.0799239575862885 0.8099429309368134,1.3499048352241516 l1.8898668885231018,-1.0799239575862885 4.85965758562088,0.0 l2.9697906970977783,1.6198858618736267 0.2699809893965721,1.6198858618736267 l3.7797337770462036,4.319695830345154 0.5399619787931442,1.8898668885231018 l-3.7797337770462036,1.0799239575862885 -2.42982879281044,4.049714803695679 l0.0,1.0799239575862885 -6.479543447494507,1.6198858618736267 l-7.019505500793457,0.5399619787931442 1.3499048352241516,-1.0799239575862885 l-4.589676558971405,0.0 -2.159847915172577,-0.5399619787931442 l-2.9697906970977783,-1.3499048352241516 -1.6198858618736267,-1.3499048352241516 l-0.8099429309368134,-1.3499048352241516 2.9697906970977783,-2.42982879281044 l-0.2699809893965721,-0.8099429309368134 -5.3996193408966064,-2.6998096704483032 l-0.8099429309368134,-1.0799239575862885 0.0,-4.319695830345154 l0.5399619787931442,-0.5399619787931442 -1.6198858618736267,-1.0799239575862885 l-1.6198858618736267,-0.5399619787931442 -3.5097527503967285,0.2699809893965721 l-1.6198858618736267,1.8898668885231018 -0.2699809893965721,1.0799239575862885 l0.0,2.6998096704483032 0.5399619787931442,1.3499048352241516 l6.209562420845032,0.0 2.159847915172577,-0.5399619787931442 m-6.479543447494507,-8.099429607391357 l1.3499048352241516,-0.5399619787931442 1.0799239575862885,-1.6198858618736267 l0.5399619787931442,0.5399619787931442 0.0,2.9697906970977783 m-2.159847915172577,-1.8898668885231018 l0.0,1.6198858618736267 m-0.8099429309368134,2.42982879281044 l0.2699809893965721,0.8099429309368134 m12.959086894989014,14.308991432189941 l0.0,3.5097527503967285 m4.049714803695679,-2.42982879281044 l-0.5399619787931442,2.42982879281044 m9.17935311794281,-1.8898668885231018 l0.0,2.9697906970977783 m2.6998096704483032,-3.2397717237472534 l0.0,2.42982879281044 " fill="none" stroke="black" stroke-width="1" /></svg>
			</div>
		</div>
	</section>

	<section id="end">
		<div class="container">
			<h2>Play again?</h2>
			<a href="#play" class="btn btn-primary">Yes</a>
			<a href="#home" class="btn btn-danger">No</a><!-- oh no this will erase your enrollment profiles! -->
		</div>
	</section>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/vivus/0.4.4/vivus.min.js"></script>
	<script src="./jquery.min.js"></script>
	<script src="./recorder.js"></script>
	<script src="./microsoft.cognitiveservices.speech.sdk.bundle.js"></script>
	<script src="./speaker-recognition-api-demo-core.js"></script>
	<script src="./voice.js"></script>
	<script>
		new Vivus('working-canvas',
                    {duration: 88, type:'oneByOne', pathTimingFunction: Vivus.EASE})
		$('#kms').click(function(){
			$.get('/another.svg', function(res){
				let response = res
				$('#canvas').html(response)
				$('svg')[0].setAttribute('id', 'working-canvas')
				$('svg').removeAttr('viewBox');
				$('svg').removeAttr('width')
				$('svg')[0].setAttribute('preserveAspectRatio', 'none')
				$('svg').removeAttr('height')
				$('svg')[0].setAttribute("viewBox", "20 0 50 50");
				new Vivus('working-canvas',
                    {duration: 500, type:'oneByOne', pathTimingFunction: Vivus.EASE})
			}, 'text').fail(function(){
				alert("Error receiving drawing.")
			})
		})
		var recorder;
		var audio_context;

		function onMediaSuccess(stream, callback, secondsOfAudio) {
			audio_context = audio_context || new window.AudioContext;
			var input = audio_context.createMediaStreamSource(stream);
			recorder = new Recorder(input);
			recorder.record();
				
			setTimeout(() => { StopListening(callback); }, secondsOfAudio*1000);
		}

		function onMediaError(e) {
				console.error('media error', e);
		}

		function StopListening(callback){
			console.log('...working...');
			recorder && recorder.stop();
			recorder.exportWAV(function(blob) {
					callback(blob);
			});
			recorder.clear();
		}

	</script>
</body>
</html>
